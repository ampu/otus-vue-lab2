import{m as C,r as p}from"./index-47bfd8d1.js";import{u as N}from"./author-store-1fa404e3.js";const g={GET_BOOKS:"https://www.googleapis.com/books/v1/volumes"},R=o=>{var l,m;const{id:r,volumeInfo:i,saleInfo:s}=o,{title:E,authors:d,publishedDate:f,description:e,industryIdentifiers:t,imageLinks:u,categories:v}=i,[n]=(d==null?void 0:d.map(b))??[],[h]=v??[];return{book:{id:r,isbn:(l=t==null?void 0:t.find(({type:a})=>a==="ISBN_13"))==null?void 0:l.identifier,year:Number.parseInt(f)||void 0,title:E,authorId:n==null?void 0:n.id,posterUrl:u.thumbnail,description:e,tags:[],price:(m=s.retailPrice)==null?void 0:m.amount,category:h},author:n}},b=o=>({id:o,name:o}),w={async getBooks(o){const i=(await fetch(`${g.GET_BOOKS}?q=${encodeURIComponent(o)}`).then(s=>s.json())).items.map(R);return{books:i.map(({book:s})=>s).filter(Boolean),authors:i.map(({author:s})=>s).filter(Boolean)}}};var c=(o=>(o.NONE="NONE",o.SUCCESS="SUCCESS",o.ERROR="ERROR",o.PENDING="PENDING",o))(c||{});const O=C("book",()=>{const o=p(c.NONE),r=p([]),i=()=>o.value,s=async e=>{r.value.push(e)};return{addBook:s,removeBook:async({id:e})=>{r.value=r.value.filter(t=>t.id!==e)},getBooks:e=>{if(!e)return r.value;const{title:t,minYear:u,maxYear:v,category:n,minPrice:h,maxPrice:k}=e,l=t==null?void 0:t.toLowerCase(),m=n==null?void 0:n.toLowerCase();return r.value.filter(a=>{var B,S;return(!l||((B=a.title)==null?void 0:B.toLowerCase().includes(l)))&&(!u||u<=a.year)&&(!v||a.year<=v)&&(!m||((S=a.category)==null?void 0:S.toLowerCase().includes(m)))&&(!h||h<=a.price)&&(!k||a.price<=k)})},getFetchStatus:i,fetchBooks:async()=>{if(![c.PENDING,c.SUCCESS].includes(o.value))try{o.value=c.PENDING;const{books:e,authors:t}=await w.getBooks("vue.js");e.forEach(s);const{addAuthor:u}=N();t.forEach(u),o.value=c.SUCCESS}catch(e){o.value=c.ERROR,console.error(e.stack)}}}});export{c as O,O as u};
